# The Paper  
## Introductio
传统的蛋白质工程方法通过对自然蛋白质序列进行迭代突变和选择，以识别具有期望的功能和结构特性的蛋白质。相比之下，理性或从零开始的蛋白质设计方法旨在提高创造具有期望特性的新蛋白质的效率和精确度。基于结构的从零开始设计方法利用基于生物物理原理的模拟，而共演化方法则从进化序列数据构建统计模型，以指定具有期望功能或稳定性的新序列。结构方法和共演化方法都有其局限性。结构方法依赖于稀缺的实验结构数据和难以处理或无法处理的生物物理模拟。共演化统计模型定制于特定的蛋白质家族，经常依赖于多序列比对，并且在定义的多序列比对之外的空间操作不佳。最近，深度神经网络作为蛋白质科学和工程的生成模型和判别模型显示出了前景。它们学习复杂表示的能力对于有效利用呈指数级增长的多样化且相对未注释的蛋白质数据源至关重要——包含数以百万计原始未比对蛋白质序列的公共数据库。  

受到基于深度学习的自然语言模型成功的启发，这些模型经过大量文本语料的训练，能够生成涵盖多种主题和情感的逼真文本，我们开发了ProGen，这是一个基于数百万条原始蛋白质序列训练的蛋白质语言模型，它能够生成跨多个家族和功能的人造蛋白质。虽然之前的工作已经表明，受自然语言启发的蛋白质统计表示对于蛋白质信息学任务（如稳定性预测、远源同源性检测和二级结构预测）是有用的，我们展示了如何采用基于深度学习的最新语言建模进展，从头开始生成功能与自然蛋白质一样好的人造蛋白质序列。  

ProGen通过迭代优化来学习预测在一条原始序列中，给定前面的氨基酸后下一个氨基酸的概率，而不需要显式的结构信息或成对的共演化假设。通过这种无监督方式从一个大型、多样化的蛋白质序列数据库（补充表1）训练，ProGen学习了一个通用的、领域独立的蛋白质表示，这种表示包含了局部和全局结构模式，类似于自然语言模型学习语义和语法规则。训练完成后，ProGen可以被提示从头开始为任何蛋白质家族生成全长蛋白质序列，这些序列与自然蛋白质有不同程度的相似性。在常见情况下，如果某个蛋白质家族的一些序列数据是可用的，我们可以使用预训练语言模型的微调技术，用家族特定的序列来进一步提高ProGen捕获与蛋白质家族对应的局部序列邻域分布的能力。  

ProGen是一个拥有12亿参数的神经网络，使用一个公开可用的包含2.8亿蛋白质序列的数据集进行训练。ProGen的一个关键组成部分是条件生成，即，通过控制标签（例如，蛋白质家族：Pfam ID PF16754, Pesticin）控制序列生成，这些标签作为输入提供给语言模型。在自然语言的情况下，这些控制标签可能是风格、主题、日期和其他实体。对于蛋白质而言，控制标签是蛋白质家族、生物过程和分子功能等属性，这些属性在公共蛋白质数据库的大量序列中是可用的。

![figure 1](fig1-1.png)    

图1 | 利用条件语言建模的人造蛋白质生成。a，条件语言模型是可以生成语义上和语法上正确的、新颖且多样化的自然语言文本的深度神经网络，通过输入控制标签来驾驭文本的风格、主题和其他实体。b，c，类似于自然语言模型，我们开发了ProGen，一个条件蛋白质语言模型（b），它根据输入控制标签（c）生成跨蛋白质家族的多样化人造蛋白质序列。d，ProGen使用一个大型的、普遍的蛋白质序列数据集进行训练，该数据集包含来自数千个家族的2.8亿个自然进化的蛋白质，其中五个多样化的溶菌酶家族在本研究中被实验性地表征。e，ProGen是一个基于变压器架构的12亿参数神经网络，该架构使用自注意力机制来建模全面的残基间相互作用。ProGen通过在普遍蛋白质序列数据集上最小化下一个氨基酸预测问题的损失来训练生成人造序列。 

## Results
我们通过在五个不同的溶菌酶家族的蛋白质上测试其生成物，实验性地评估了ProGen生成功能性人造氨基酸序列的能力（补充表2）。这些蛋白质家族包含大量的序列多样性（补充表3），平均序列长度在各个家族之间变化，从84到167不等。这些序列还显示出大的结构多样性和多种结构折叠（补充图2）。作为一个整体，对于一个在生成时不受限于已知功能野生型附近的局部序列邻域，并且也没有提供结构先验的模型来说，这代表了一个挑战性的设计空间。我们从Pfam和UniprotKB源收集了这五个家族的55,948个序列，以获得积极的对照，并用于微调ProGen。  

使用精选的溶菌酶数据集对ProGen进行微调后，我们通过为每个家族提供Pfam ID作为控制标签，使用ProGen生成了一百万条人造序列。我们的人造溶菌酶跨越了自然溶菌酶的序列景观（图2a），涵盖了包含多种蛋白质折叠、活性位点架构和酶促机制的五个家族。由于我们的模型可以在毫秒内生成全长人造序列，因此可以创建一个大型数据库，以扩展超越自然库的合理序列多样性（补充表3）。尽管从序列身份计算的角度看，人造序列可能与自然序列有所偏离（图2b和补充图3），但在形成每个家族内的自然和人造蛋白质的单独多序列比对时，它们显示出类似的残基位置熵。这表明模型捕获了进化保守模式，而无需训练显式的比对信息，如使用波特模型，正如在直接耦合分析中实现的那样。 

![figure 2](fig1-2.png)  

图2 | 生成的人造抗菌蛋白质多样且在我们的实验系统中表达良好。a，在使用t分布随机邻域嵌入（t-SNE）作为降维技术进行可视化分析时，我们模型的人造序列被展示为跨越了五个溶菌酶家族自然蛋白质的景观。每个点代表一个在二维t-SNE空间中嵌入的自然或生成序列。b，通过足够的采样，ProGen能生成与自然蛋白质高度不同的序列。最大ID测量人造蛋白质与任何公开可用的自然蛋白质的最大相似度。c，人造蛋白质保持了与自然蛋白质在家族间相似的进化保守模式。图展示了一库蛋白质中每个对齐位置的可变性。保守位置表现为曲线低谷。seq.，序列。d，从我们生成的蛋白质中，我们选择一百个蛋白质进行合成和在我们的实验设置中的表征。e，即使与自然的不同性增加（40-50%最大ID），人造蛋白质也表达良好，并且产生的表达质量与一百个代表性自然蛋白质相当。  

为了实验性地评估ProGen在从自然蛋白质序列发散的范围内的表现，我们基于生成质量和与自然序列的多样性选择了一百个序列，通过衡量与我们训练数据集中的任何蛋白质的最高命中身份（“最大ID”）来测量，该数据集包含2.8亿蛋白质，主要由UniParc21组成（补充图4）。我们选择的蛋白质包括100个人造序列（补充表2），每个蛋白质家族至少有8个蛋白质。人造蛋白质的平均序列长度在各个家族之间变化，从93到179不等，与我们从Pfam精选数据集中的自然溶菌酶可比。人造蛋白质包括在溶菌酶家族特定比对中从未在对齐位置观察到的特定氨基酸和成对相互作用（补充表4和5）。我们还从55,948个精选的溶菌酶序列中选择了一个正面对照组。我们使用MMseqs2对自然序列进行了聚类，并从五个家族中的每一个家族大约选择了20个聚类代表性序列。  

为了评估功能，我们通过无细胞蛋白质合成和亲和层析法合成并纯化了全长基因。在100种天然蛋白质的正向对照组中，有72%的蛋白质通过层析峰和条带可视化方法被良好地表达。ProGen生成的蛋白质同样良好地表达（总共100个中有72个），跨越所有与任何已知天然蛋白质的序列同一性区间（最大同一性40–90%；图2e）。此外，我们使用bmDCA7设计了人工蛋白质，这是一个基于直接耦合分析的统计模型，它明确近似了一阶和二阶残基依赖性。从他们公开可用的代码开始，我们试图使bmDCA模型与ProGen收敛到相同的序列，并使用额外的比对信息，在广泛的超参数范围内进行搜索。bmDCA无法拟合五个溶菌酶家族中的三个，并且在剩余的两个蛋白质家族中展示了60%的可检测表达（50个蛋白质中的30个）。这些结果表明，与一批天然蛋白质相比，ProGen可以生成结构良好、适于正确表达的人工蛋白质，即使序列比对的大小和质量限制了替代方法的成功。  

接下来，我们基于荧光素标记的微球菌溶解素细胞壁（分子探针EnzChek溶菌酶试剂盒）的猝灭释放来检查活性，从每组表达的100个蛋白质中随机选择了90个蛋白质。蛋白质在96孔板格式中准备，以提取随时间变化的荧光曲线（图3a）。天然进化的典范蛋白质，鸡蛋清溶菌酶（HEWL），作为阳性对照测量，此外还有泛素作为阴性对照。生成荧光高于任何阴性对照最大荧光一个标准偏差的蛋白质被认为是功能性的。在我们的人工蛋白质中，73%（66/90）是功能性的，并在各个家族中表现出高水平的功能性（图3c）。代表性的天然蛋白质表现出类似的功能水平，59%（53/90）的总蛋白质被认为是功能性的。所有的bmDCA人工蛋白质都没有表现出可检测的功能水平（补充图5），这可能是由于收敛、抽样或其他特定模型运行问题，进一步突出了ProGen提供的可能更为稳健的替代方案的多功能性。这些结果表明，ProGen生成的蛋白质序列不仅能够良好表达，而且还能在蛋白质家族的不同序列景观中保持酶功能。  

![图3](fig1-3.png)  

图3 | 人工蛋白质序列在达到低至31%的同一性到任何已知蛋白质时仍具有功能性，展示了与高度进化的天然蛋白质相当的催化效率，并展现了与已知天然折叠相似的结构。a，人工蛋白质能够很好地结合底物并随时间展示高荧光响应（n = 90）。对于HEWL和阴性（泛素）对照，展示了n = 3重复实验的最小和最大荧光范围作为条形图。b，即使与已知天然蛋白质不相似（40-50%最大同一性，即，顶部命中同一性），人工蛋白质仍保持活性。异常值表示高活性样本，其中相对活性是相对于HEWL计算的。箱形图基于每个类别从上到下分别的n = 90, 23, 28, 22, 8, 9个样本得出。箱形图显示中位数、第一四分位数和第三四分位数，须线延伸到1.5倍四分位距。c，人工蛋白质在蛋白质家族中具有功能性。功能性定义为荧光比所有阴性对照的最大值高出一个标准差。d，HEWL天然溶菌酶（红色）和两种生成的溶菌酶（蓝色；L056和L070）针对细胞壁底物的Michaelis-Menten动力学展示了可比的性能（n = 3个技术重复，误差条表示标准偏差）。e，我们确定了L056人工溶菌酶的2.5埃分辨率晶体结构。以天空蓝色呈现的L056晶体结构与两种代表性的T4溶菌酶构象的全局叠加图，‘开放’构象的M6I T4溶菌酶（PDB访问号150L）以深红色显示，‘闭合’构象的野生型T4溶菌酶（PDB访问号3FA0）以橙色显示，以及按元素着色的底物（PDB访问号148L）。催化苏氨酸（L056中的T30和T4溶菌酶中的T26）和第一个催化谷氨酸（L056中的E15和T4溶菌酶中的E11）以棒状表示。f，条形图代表了派生自溶菌酶变体的Michaelis-Menten kcat/KM常数，展示了对于最大序列同一性到已知天然蛋白质不同的变体之间的一系列催化活性。误差条代表由拟合过程得出的传播标准偏差（A5、L056和L070技术重复n = 3；C9和E11技术重复n = 4；每个n = 4技术重复的两个生物重复对于D4）。星号表示从初始速率分析派生的kcat/KM，并转换了单位（补充表7）。  

除了功能性的二进制值，我们还计算了相对于HEWL的体外测定的相对活性得分。我们的人工蛋白质即使在与任何已知天然蛋白质的序列同一性较低的情况下，也能匹配天然蛋白质的活性水平（图3b和补充图6）。值得注意的是，一小部分蛋白质，无论是天然蛋白质还是人工蛋白质，都在HEWL的一个数量级内，HEWL的活性显著高于所有阴性对照。这些高度活跃的异常值展示了我们的模型生成可能与经过进化压力高度优化的天然蛋白质竞争的序列的潜力。    

从100个人工蛋白质中，我们选择了五种蛋白质，它们覆盖了一个宽范围的最大同一性（48–89%）以在大肠杆菌中重组表达。其中，只有一个L008没有产生可检测的表达（补充图7）。两个（L013和L038）表达稳健到包涵体中，没有进一步追求。两种蛋白质，L056（最大ID 69.6%）和L070（最大ID 89.2%）表达良好，并对在16°C过夜诱导期间使用的大肠杆菌BL21（DE3）菌株产生了细菌杀伤活性。花费的培养基拥有酶活性，因此，酶从这种材料中纯化出来。    

虽然两种酶都以预期的大小作为单体通过体积排除色谱法纯化，但我们还观察到每种酶的一个定义的后洗脱（表观较低分子量，可能由于与色谱柱的葡聚糖组分结合）物种，通过SDS-PAGE对应于全长酶（补充图7）。两种单体的KM值过弱，无法使用异质的、荧光素标记的M. lysodeikticus细胞壁底物（分子探针EnzChek溶菌酶试剂盒）来测量；然而，两种单体使用假一级动力学测定法都是活跃的（补充图8）。相比之下，我们可以轻松测量纯化的表观较低分子量物种的KM值，其中L056和L070都非常活跃，并且与HEWL的Michaelis-Menten参数相当（图3d）。总的来说，L056和L070具有与HEWL可比的强大催化活性和杀菌能力，同时它们与最近已知的天然序列分别相差53和18个氨基酸。我们还发现，使L056和L070与它们各自最近的天然序列同源体发生差异的突变在位置或结构元素上没有偏见。不同的残基反而是均匀分布的。一些突变甚至发现在活性位点裂隙内以及影响构象状态的区域内（对于L056）。尽管具有可比的酶活性，L070和L056的序列同一性仅共享17.9%。总之，这些结果证明ProGen可以生成具有近乎天然活性的人工蛋白质。  

接下来，我们检查了人工蛋白质的结构分歧。我们确定了L056的2.5Å分辨率晶体结构（图3e和补充表6）。全局折叠与预测类似，与trRosetta预测的主链结构的Cα均方根偏差（RMSD）为2.9Å，与野生型T4溶菌酶结构的2.3Å RMSD。最大的结构分歧发生在由18-31残基形成的beta发夹。这个区域形成了底物结合裂缝的底部，并且是重要的底物结合运动的一部分。T4溶菌酶的M6I突变体的结构（蛋白质数据银行（PDB）访问号150L）被用作这个铰链“开放”状态的模型，并且更接近L056的结构（1.0Å Cα RMSD）。与一个共价困住底物的结构对齐（PDB访问号148L）揭示，活性位点裂缝形成良好，关键的催化残基Glu15（在T4L中为Glu 11）和关键的底物结合残基Thr30（在T4L中为Thr26）位置正确。此外，L056的疏水核心包装良好，只有两个小于5Å³体积的小包装空隙，这对于此大小的结构是典型的。  

为了检查ProGen是否能在序列同一性的“暮光区”生成功能性蛋白质，其中两种蛋白质不被假设具有功能相似性，我们生成了95种新的人工序列，其最大序列同一性低于40%，对两个溶菌酶家族（PF00959和PF05838）。在选定的序列中，78/89（88%）表达良好，78中的24（31%）是可溶的（补充图9）。我们纯化了六种高表达的蛋白质，并发现它们都是活跃的，但与HEWL或之前生成的人工蛋白质L056和L070相比，Michaelis-Menten活性较低（图3f，补充图10和补充表7）。与天然蛋白质序列同一性最低的蛋白质D4（对一个Arcobacter nitrofigilis生物的蛋白质有31.4%的ID），其kcat/KM为20.2 M−1s−1，约为HEWL的200倍以下。虽然这些远程蛋白的活性显著较低，但可以采用定向进化来提高活性。总的来说，这些结果展示了一种生成足够远离序列空间、可能不被认为是传统序列同源体的可溶、活跃蛋白质的程序。  

为了进一步比较结构表示，我们使用AlphaFold2来预测功能性人工序列的结构。如L056的晶体结构，预测的人工结构大致匹配自然界中发现的已知结构（补充图11），包括低同一性（<40%）的人工序列。  

训练于跨越多个家族的普遍蛋白质序列数据集的ProGen，当提供相应的控制标签作为输入时，能够为任何家族设计蛋白质。为了探索这一能力超越溶菌酶家族，我们评估了ProGen在生成和预测先前其他方法已应用家族的功能性全长序列方面的性能：异戊二烯酸变构酶（CM）和苹果酸脱氢酶（MDH）。生成的蛋白质展示了与天然序列库类似的保守模式（图4a,d）。在将生成物与已知结构的序列对齐后（图4b,e），我们观察到生成序列中的保守位置与配体结合和埋藏残基相关。使用先前发表的序列及其对CM和MDH蛋白的实验测定数据，我们还评估了ProGen模型可能性与这些序列的相对活性的一致性，并将其与原始研究中使用的生成方法——bmDCA和proteinGAN进行了比较。具体来说，我们测量了使用ProGen的人工序列的每个令牌对数可能性，并使用它们来预测人工序列是否应该功能。在CM功能数据上，ProGen的对数可能性曲线下面积（AUC）为0.85，显著优于bmDCA的0.78（图4c）（P < 0.0001，双尾测试，n = 1617）。在MDH功能数据上，ProGen的对数可能性AUC为0.94（图4f），优于ProteinGAN鉴别器分数的AUC 0.87（P < 0.1，双尾测试，n = 56）。总的来说，ProGen的模型可能性与两个不同蛋白质数据集——CM和MDH——的实验测定数据更为一致，优于原始研究中特别为这些家族定制的序列生成方法。

![图4](fig1-4.png)  

图4 | 条件语言建模在其他蛋白质系统的适用性。a,b，使用适当的控制标签，我们的语言模型ProGen可以为不同的蛋白质家族生成序列。这里我们展示ProGen可以生成CM酶，这些酶展示了与自然界相似的残基分布（a）以及生成序列中的保守残基与配体结合位点相关（b）。c，ProGen的模型可能性也可以准确预测已发布数据中CM变体的功能性，略优于原始研究中的共进化bmDCA7算法。d，ProGen也可以生成展示了与自然界相似残基分布的MDH蛋白。e，生成序列中的保守残基与埋藏残基相关。f，ProGen的模型可能性在预测已发布的MDH变体的功能性方面也是准确的，与原始研究中使用的生成性proteinGAN55模型相似。  

为了理解普遍序列数据集和感兴趣的蛋白质家族序列对ProGen生成能力的相对影响，我们使用CM和MDH的实验测定数据进行了两项削减研究。首先，我们评估了仅用普遍序列数据集训练的ProGen的性能。我们为这个版本的ProGen测量了使用CM和MDH控制标签的人工序列的每个令牌对数可能性。这些可能性显示，与经过微调的ProGen相比，预测人工序列是否应该功能时，AUC显著下降了CM的0.18（P < 0.0001，双尾测试，n = 1,617）和MDH的0.08（P < 0.1，双尾测试，n = 56）。相反，仅在CM和MDH蛋白质序列上训练的ProGen架构，没有普遍序列数据集的初始训练的好处，与经过微调的ProGen相比，性能也显著下降——AUC分别下降了0.11（P < 0.0001，双尾测试，n = 1,617）和0.04（P < 0.05，双尾测试，n = 56）。这些结果表明，我们的训练策略的两个组成部分——普遍序列数据集的初始训练和对感兴趣的蛋白质家族的微调——对最终模型性能有重大贡献。使用包含许多蛋白质家族的普遍序列数据集进行训练，使ProGen能够学习一种通用的和可转移的序列表示，编码了内在的生物属性。对感兴趣的蛋白质家族的微调引导了这种表示，以提高局部序列邻域的生成质量。类似于在自然语言处理和计算机视觉中，使用大数据集训练的神经网络通过转移学习和微调所显示的适应性，蛋白质语言模型有潜力成为生成具有所需属性的定制蛋白质的多功能工具。在补充图12中，不同蛋白质家族的可用序列分布表明，我们当前的技术在蛋白质宇宙的很大一部分中将是有用的。我们推测，可能有可能成功生成具有功能活性的人工蛋白质，特别是对于较大的蛋白质家族，尽管可能会以较小的成功率这样做。在我们的研究中，我们没有尝试在没有额外微调的情况下实验测试生成的序列。 

## Discussion
总之，我们的研究显示，一个仅使用进化序列数据训练的最新的基于变压器的条件语言模型能够跨蛋白质家族生成功能性人工蛋白质。额外的分析表明，我们的模型已经学习了一种灵活的蛋白质序列表示，可以应用于多样的家族，如溶菌酶、CM和MDH。虽然我们不期望我们的语言模型生成属于完全不同分布或领域的蛋白质（例如，创造一个催化非自然反应的新折叠），但它可以大幅扩展由进化抽样的蛋白质序列空间。结合生物物理建模与生成模型可能进一步帮助我们探索与进化抽样完全不同的数据分布。我们模型的应用可能包括生成合成的高度可能功能性蛋白质库，用于发现或迭代优化。结合不断增加的序列数据来源和更具表现力的控制标签，我们的工作指出了使用基于深度学习的语言模型进行精确从头设计蛋白质以解决生物学、医学和环境问题的潜力。  

## 在线内容
任何方法、额外参考资料、《自然》投稿系列报告摘要、源数据、扩展数据、补充信息、致谢、同行评审信息；作者贡献细节和竞争利益声明；以及数据和代码可用性声明都可以在https://doi.org/10.1038/s41587-022-01618-2处获得。 














